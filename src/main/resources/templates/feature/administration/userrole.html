<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org"
	xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity3">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<title>MTS Web Client- Mandantenkonfiguration</title>

<link th:href="@{/css/bootstrap.css}" rel="stylesheet" media="screen" />
<link th:href="@{/css/bootstrap-theme.css}" rel="stylesheet"
	media="screen" />
<link th:href="@{/css/webclient.css}" rel="stylesheet" />
<link th:href="@{/css/bootstrap-select.css}" rel="stylesheet" />
<link th:href="@{/css/bootstrap-switch.css}" rel="stylesheet" />
<link th:href="@{/css/bootstrap-colorpicker.css}" rel="stylesheet" />

<script th:src="@{/js/jquery.js}"></script>
<script th:src="@{/js/bootstrap.js}"></script>
<script th:src="@{/js/bootstrap-select.js}"></script>
<script th:src="@{/js/bootstrap-treeview.js}"></script>
<script th:src="@{/js/bootstrap-switch.js}"></script>
<script th:src="@{/js/bootstrap-colorpicker.js}"></script>
<script th:src="@{/js/webclient.js}"></script>

<script type="text/javascript" th:inline="text">
	/*<![CDATA[*/
	$(document)
			.ready(
					function() {
						$('#rolesAddRow')
								.click(
										function() {
											var rowIndex = $(
													'#roleTable tbody')
													.children().length;
											$('#roleTable tbody')
													.append(
															"<tr>"
																	+ "<td>"
																	+ "<input class='form-control' placeholder='[[#{rolesTableName}]]' id='name-" + rowIndex + "' name='roles[" + rowIndex + "].name' />"
																	+ "</td>"
																	+ "<td>"
																	+ "<input class='form-control' placeholder='[[#{rolesTableDescription}]]' id='description-" + rowIndex + "' name='roles[" + rowIndex + "].description' />"
																	+ "</td>"
																	+ "<td>"
																	+ "<input id='switch-" + rowIndex + "' type='checkbox' name='role-state-switch' data-size='mini' data-checked='false' data-on-color='success' data-off-color='warning'></input><input type='hidden' id='hiddenSwitch-" + rowIndex + "' name='roles[" + rowIndex + "].enabled' />"
																	+ "</td>"
																	+ "<td>"
																	+ "<a href='#' class='a_delete' title='[[#{rolesActionDelete}]]' id='a_delete-"+ rowIndex +"''><span class='glyphicon glyphicon-remove'> </span></a><input type='hidden' id='hiddenRid-"+ rowIndex +"' name='roles["+ rowIndex +"].rid' /><input type='hidden' id='hiddenDelete-"+ rowIndex +"' name='roles[" + rowIndex + "].delete}' />"
																	+ "</td>"
																	+ "</tr>");
						
											$('#a_delete-' + rowIndex)
													.click(
															function(event) {
																var collectionIndex = $(
																		event.target)
																		.parent()
																		.attr(
																				'id')
																		.split(
																				"-");

																var row = $(
																		event.target)
																		.parent()
																		.parent()
																		.parent();

																$(
																		"#hiddenDelete-"
																				+ collectionIndex[1])
																		.val(
																				true);

																$(
																		"#rolesSave")
																		.removeClass(
																				"disabled");

																row.hide();
															});
											
											$('#switch-' + rowIndex)
											.bootstrapSwitch()
											.on(
													'switchChange.bootstrapSwitch',
													function(event,
															state) {
														var collectionIndex = event.target.id
																.split("-");
														$(
																"#hiddenSwitch-"
																		+ collectionIndex[1])
																.val(
																		state);
														$(
																"#rolesSave")
																.removeClass(
																		"disabled");
													});

											$("#rolesSave").removeClass(
													"disabled");
											
											$("#hiddenSwitch-" + rowIndex).val(
													false);
										});

						$("[name='role-state-switch']").bootstrapSwitch().on(
								'switchChange.bootstrapSwitch',
								function(event, state) {
									var collectionIndex = event.target.id
											.split("-");
									$("#hiddenSwitch-" + collectionIndex[1])
											.val(state);
									$("#rolesSave").removeClass(
											"disabled");
								});
						
						$('.form-control').change(function() {
							$("#rolesSave").removeClass("disabled");
						});

						$("#rolesSave").click(function() {
							$("#rolesForm").submit();
						});

						$('.a_delete').click(
								function(event) {
									var collectionIndex = $(event.target)
											.parent().attr('id').split("-");

									var row = $(event.target).parent().parent()
											.parent();

									$("#hiddenDelete-" + collectionIndex[1])
											.val(true);
									$("#rolesSave").removeClass(
											"disabled");

									row.hide();
								});

					});
	/*]]>*/
</script>

<style type="text/css">
body {
	padding-top: 127px;
}
</style>

</head>
<body>
	<!-- {!begin layout} -->
	<div th:include="layout :: header"></div>
	<!-- {!end layout} -->

	<div class="wrapper" id="wrapper">
		<!-- div class="row"-->
		<div id="navigation" class="navigation">

			<div id="submenu" class="container navigation-submenu">
				<div class="panel-group" id="accordion">
					<div class="panel panel-default">
						<div class="panel-heading">
							<h4 class="panel-title">
								<a data-toggle="collapse" data-parent="#accordion"
									href="#collapseOne"><span class="glyphicon glyphicon-home">
								</span><span th:text="#{menuTreeClient}"></span></a>
							</h4>
						</div>
						<div id="collapseOne" class="panel-collapse collapse">
							<div class="panel-body">
								<table class="table">
									<tr sec:authorize="hasAnyRole('SETUP_ROLE', 'SECURITY_ADMIN_ROLE')">
										<td><a href="/admin/client"><span th:text="#{menuTreeClientConfig}"></span></a></td>
									</tr>
									<tr>
										<td><a href="/admin/clientp"><span th:text="#{menuTreeClientProperties}"></span></a></td>
									</tr>
								</table>
							</div>
						</div>
					</div>
					<div class="panel panel-default" sec:authorize="hasAnyRole('SETUP_ROLE', 'SECURITY_ADMIN_ROLE')">
						<div class="panel-heading">
							<h4 class="panel-title">
								<a data-toggle="collapse" data-parent="#accordion"
									href="#collapseTwo"><span class="glyphicon glyphicon-user">
								</span><span th:text="#{menuTreeUser}"></span></a>
							</h4>
						</div>
						<div id="collapseTwo" class="panel-collapse collapse in">
							<div class="panel-body">
								<table class="table">
									<tr>
										<td><a href="/admin/user"><span th:text="#{menuTreeUserConfig}"></span></a></td>
									</tr>
									<tr>
										<td><a href="/admin/usergroup"><span th:text="#{menuTreeUserGroups}"></span></a></td>
									</tr>
									<tr class="warning">
										<td><a href="/admin/userrole"><span th:text="#{menuTreeUserRoles}"></span></a></td>
									</tr>
								</table>
							</div>
						</div>
					</div>
				</div>
			</div>

			<div class="separator"></div>
			<div class="separator-content">
				<a href="javascript:toggle_sub_menu_visibility();"> <img
					th:src="@{'/icons/separator_clickable.png'}"></img>
				</a>
			</div>
		</div>
		<div id="content" class="content">
			<nav class="navbar navbar-default navbar-top sub-nav">
				<div class="container-fluid">
					<div class="navbar-header">
						<div class="navbar-brand navbar-text-submenu">
							<span th:text="#{roleTitle}"></span>
						</div>
					</div>
					<div class="collapse navbar-collapse">
						<ul class="nav navbar-right">
							<button type="button" class="btn btn-default navbar-btn"
								id="rolesAddRow">
								<span th:text="#{rolesActionNew}"></span>
							</button>
							<button type="button" class="btn btn-default navbar-btn disabled"
								id="rolesSave">
								<span th:text="#{rolesActionSave}"></span>
							</button>
							<a class="glyph-link" href="/admin/userrole"><span
								class="glyphicon glyphicon-refresh"></span></a>
						</ul>
					</div>
				</div>
			</nav>
			<div class="container-fluid">

				<form id="rolesForm" role="form"
					th:action="@{/admin/userrole/save}" method="post"
					th:object="${roleConfig}">

					<div th:if="${#fields.hasErrors('*')}"
						class="alert alert-danger alert-dismissible fade in" role="alert">
						<button type="button" class="close" data-dismiss="alert"
							aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
						<strong><span th:text="#{rolesTableErrorMessage}"></span></strong>
					</div>

					<table class="table table-hover table-striped table-condensed"
						id="roleTable">
						<thead>
							<tr>
								<th><span th:text="#{rolesTableName}"></span></th>
								<th><span th:text="#{rolesTableDescription}"></span></th>
								<th><span th:text="#{rolesTableStatus}"></span></th>
								<th><span th:text="#{rolesTableActions}"></span></th>
							</tr>
						</thead>
						<tbody>
							<tr th:each="item, stat : *{roles}">
								<td><input th:id="${'name-'+stat.index}" type="text"
									class="form-control" placeholder="Name"
									th:field="*{roles[__${stat.index}__].name}"
									th:errorclass="field-tip" /><span class="tip-content"
									th:errors="*{roles[__${stat.index}__].name}"></span></td>
								<td><input th:id="${'description-'+stat.index}" type="text"
									class="form-control" placeholder="Beschreibung"
									th:field="*{roles[__${stat.index}__].description}"
									th:errorclass="field-tip" /><span class="tip-content"
									th:errors="*{roles[__${stat.index}__].description}"></span></td>
								<td><input th:id="${'switch-'+stat.index}" type="checkbox"
									name="role-state-switch" data-size="mini"
									th:checked="*{roles[__${stat.index}__].enabled}"
									data-on-color="success" data-off-color="warning"></input> <input
									type="hidden" th:id="${'hiddenSwitch-'+stat.index}"
									th:field="*{roles[__${stat.index}__].enabled}" /></td>
								<td><a class="a_delete" th:id="${'a_delete-'+stat.index}"
									href="#" th:title="#{rolesActionDelete}"><span
										class="glyphicon glyphicon-remove"> </span></a><input
									type="hidden" th:id="${'hiddenRid-'+stat.index}"
									th:field="*{roles[__${stat.index}__].rid}" /><input
									type="hidden" th:id="${'hiddenDelete-'+stat.index}"
									th:field="*{roles[__${stat.index}__].delete}" /></td>
							</tr>
						</tbody>
					</table>
				</form>
			</div>
		</div>
	</div>
</body>
</html>