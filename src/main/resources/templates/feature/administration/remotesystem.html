<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org"
	xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity3">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<title>MTS Web Client- Mandantenkonfiguration</title>

<link th:href="@{/css/bootstrap.css}" rel="stylesheet" media="screen" />
<link th:href="@{/css/bootstrap-theme.css}" rel="stylesheet"
	media="screen" />
<link th:href="@{/css/webclient.css}" rel="stylesheet" />
<link th:href="@{/css/bootstrap-select.css}" rel="stylesheet" />
<link th:href="@{/css/bootstrap-switch.css}" rel="stylesheet" />
<link th:href="@{/css/bootstrap-colorpicker.css}" rel="stylesheet" />

<script th:src="@{/js/jquery.js}"></script>
<script th:src="@{/js/bootstrap.js}"></script>
<script th:src="@{/js/bootstrap-select.js}"></script>

<script th:src="@{/js/bootstrap-switch.js}"></script>
<script th:src="@{/js/bootstrap-colorpicker.js}"></script>
<script th:src="@{/js/webclient.js}"></script>

<script type="text/javascript" th:inline="text">
	/*<![CDATA[*/
	$(document)
			.ready(
					function() {
						$('#remoteSystemsAddRow')
								.click(
										function() {
											var rowIndex = $('#remoteSystemTable tbody')
													.children().length;
											$('#remoteSystemTable tbody')
													.append(
															"<tr>"
																	+ "<td>"
																	+ "<input class='form-control' placeholder='[[#{usersTableLogin}]]' id='login-" + rowIndex + "' name='users[" + rowIndex + "].login' />"
																	+ "</td>"
																	+ "<td>"
																	+ "<select class='form-control' id='type-" + rowIndex + "' name='users[" + rowIndex + "].internal'><option value='true' text='[[#{usersTypeSelectDb}]]'>[[#{usersTypeSelectDb}]]</option><option value='false' text='[[#{usersTypeSelectLdap}]]'>[[#{usersTypeSelectLdap}]]</option></select>"
																	+ "</td>"
																	+ "<td>"
																	+ "<input class='form-control' placeholder='[[#{usersTableFirstName}]]' id='firstname-" + rowIndex + "' name='users[" + rowIndex + "].firstname' />"
																	+ "</td>"
																	+ "<td>"
																	+ "<input class='form-control' placeholder='[[#{usersTableLastName}]]' id='lastname-" + rowIndex + "' name='users[" + rowIndex + "].lastname' />"
																	+ "</td>"
																	+ "<td>"
																	+ "<input id='switch-" + rowIndex + "' type='checkbox' name='user-state-switch' data-size='mini' data-checked='true' data-on-color='success' data-off-color='warning'></input><input type='hidden' id='hiddenSwitch-" + rowIndex + "' name='users[" + rowIndex + "].enabled' value='true' />"
																	+ "</td>"
																	+ "<td>"
																	+ "<a href='#' class='a_delete' title='[[#{usersActionDelete}]]' id='a_delete-"+ rowIndex +"'><span class='glyphicon glyphicon-remove'> </span></a><a href='#' class='a_edit' id='a_edit-"+ rowIndex +"' title='[[#{usersActionEdit}]]'><span class='glyphicon glyphicon-edit'></span></a><input type='hidden' id='hiddenRid-"+ rowIndex +"' name='users["+ rowIndex +"].id' value='-1' /><input type='hidden' id='hiddenDelete-"+ rowIndex +"' name='users[" + rowIndex + "].delete' value='false' />"
																	+ "<input type='hidden' id='hiddenGroupRids-"+ rowIndex +"' name='users["+ rowIndex +"].groupIds'/>"
																	+ "<input type='hidden' id='hiddenEmail-"+ rowIndex +"' name='users["+ rowIndex +"].email' />"
																	+ "<input type='hidden' id='hiddenDefaultClient-"+ rowIndex +"' name='users["+ rowIndex +"].defaultClient' />"
																	+ "<input type='hidden' id='hiddenChangePasswordOnNextLogin-"+ rowIndex +"' name='users["+ rowIndex +"].changePasswordOnNextLogin' />"
																	+ "<input type='hidden' id='hiddenPassword-"+ rowIndex +"' name='users["+ rowIndex +"].password' />"
																	+ "<input type='hidden' id='hiddenLoginAttempts-"+ rowIndex +"' name='users["+ rowIndex +"].loginAttempts' value='0' />"
																	+ "</td>"
																	+ "</tr>");

											$('#a_delete-' + rowIndex).click(
													function(event) {
														onDeleteClick(event);
													});

											$('#switch-' + rowIndex)
													.bootstrapSwitch()
													.on(
															'switchChange.bootstrapSwitch',
															function(event,
																	state) {
																var collectionIndex = event.target.id
																		.split("-");
																$(
																		"#hiddenSwitch-"
																				+ collectionIndex[1])
																		.val(
																				state);
																$("#remoteSystemsSave")
																		.removeClass(
																				"disabled");
															});

											$("#remoteSystemsSave").removeClass(
													"disabled");

											$("#hiddenSwitch-" + rowIndex).val(
													false);

											$('.a_edit').click(function(event) {
												editOnClick(event);
											});

										});

						$("#remoteSystemEditPanel").hide();

						$("[name='remoteSystem-state-switch']").bootstrapSwitch().on(
								'switchChange.bootstrapSwitch',
								function(event, state) {
									var collectionIndex = event.target.id
											.split("-");
									$("#hiddenSwitch-" + collectionIndex[1])
											.val(state);
									$("#remoteSystemsSave").removeClass("disabled");
								});

						$('.form-control').change(function() {
							$("#remoteSystemsSave").removeClass("disabled");
						});

						$("#remoteSystemsSave").click(function() {
							$("#usersForm").submit();
						});

						$('.a_delete').click(function(event) {
							onDeleteClick(event);
						});

						$('.a_edit').click(function(event) {
							editOnClick(event);
						});

						$('#buttonRemoteSystemEditDone').click(function(event) {

							$("#remoteSystemEditPanel").hide();
							$("table tbody tr").removeClass('highlight');
						});

	function editOnClick(event) {
		var collectionIndex = $(event.target).parent().attr('id').split("-");

		var userName = $("#login-" + collectionIndex[1]).val();

		// Headertext setzen
		$("#userEditPanelHeadingName").text(" " + userName);

		$("#userEditPanel").show();
		$("#pwChangeArea").hide();
		$("#pw-change-switch").bootstrapSwitch('state', false);

		// Zuordnung EditPanel zu Benutzer festlegen
		$("#hiddenUserIndex").val(collectionIndex[1]);

		// Row highlighting
		var row = $(event.target).parent().parent().parent();
		row.addClass('highlight').siblings().removeClass('highlight');

		// bereits zugeordnete Gruppen initialisieren
		setAssignedGroups(collectionIndex[1]);
	}

	function onDeleteClick(event) {
		var collectionIndex = $(event.target).parent().attr('id').split("-");

		var row = $(event.target).parent().parent().parent();

		$("#hiddenDelete-" + collectionIndex[1]).val(true);
		$("#usersSave").removeClass("disabled");

		// Editierfenster ausblenden
		var userName = $("#login-" + collectionIndex[1]).val();
		var userEditPanel = $("#userEditPanelHeadingName").text();

		if (" " + userName == userEditPanel) {
			$("#userEditPanel").hide();
		}

		row.hide();
	}

	function removeGroupRid(groupRids, ridToRemove) {
		var groupRidsArray = groupRids.split(",");

		var index = groupRidsArray.indexOf(ridToRemove);

		if (index > -1) {
			groupRidsArray.splice(index, 1);
			var result = "";

			for (var i = 0; i < groupRidsArray.length; i++) {
				if (result.length == 0) {
					result = result + groupRidsArray[i];
				} else {
					result = result + "," + groupRidsArray[i];
				}
			}

			return result;

		} else {
			return groupRids;
		}
	}

	/*]]>*/
</script>

<style type="text/css">
body {
	padding-top: 127px;
}
</style>

</head>
<body>
	<!-- {!begin layout} -->
	<div th:include="layout :: header"></div>
	<!-- {!end layout} -->

	<div class="wrapper" id="wrapper">
		<!-- div class="row"-->

		<!-- {!begin navigation} -->
		<div
			th:include="feature/administration/adminmenu :: navigation('remotesystem', 'system')"
			id="navigation" class="navigation"></div>
		<!-- {!end navigation} -->

		<div id="content" class="content">
			<nav class="navbar navbar-default navbar-top sub-nav">
				<div class="container-fluid">
					<div class="navbar-header">
						<div class="navbar-brand navbar-text-submenu">
							<span th:text="#{remoteSystemTitle}"></span>
						</div>
					</div>
					<div class="collapse navbar-collapse">
						<ul class="nav navbar-right">
							<button type="button" class="btn btn-default navbar-btn"
								id="remoteSystemsAddRow">
								<span th:text="#{remoteSystemsActionNew}"></span>
							</button>
							<button type="button" class="btn btn-default navbar-btn disabled"
								id="remoteSystemsSave">
								<span th:text="#{remoteSystemsActionSave}"></span>
							</button>
							<a class="glyph-link" href="/admin/remotesystem"><span
								class="glyphicon glyphicon-refresh"></span></a>
						</ul>
					</div>
				</div>
			</nav>
			<div class="container-fluid">

				<form id="usersForm" role="form" th:action="@{/admin/remotesystem/save}"
					method="post" th:object="${remoteSystemConfig}">

					<div th:if="${#fields.hasErrors('*')}"
						class="alert alert-danger alert-dismissible fade in" role="alert">
						<button type="button" class="close" data-dismiss="alert"
							aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
						<strong><span th:text="#{remoteSystemsTableErrorMessage}"></span></strong>
					</div>

					<table class="table table-hover table-striped table-condensed"
						id="remoteSystemTable">
						<thead>
							<tr>
								<th><span th:text="#{remoteSystemsTableName}"></span></th>
								<th><span th:text="#{remoteSystemsTableDescription}"></span></th>
								<th><span th:text="#{remoteSystemsTableStatus}"></span></th>
								<th><span th:text="#{remoteSystemsTableActions}"></span></th>
							</tr>
						</thead>
						<tbody>
							<tr th:each="item, stat : *{remoteSystems}">
								<td><input th:id="${'name-'+stat.index}" type="text"
									class="form-control" placeholder="Name"
									th:field="*{remoteSystems[__${stat.index}__].name}"
									th:errorclass="field-tip" /><span class="tip-content"
									th:errors="*{remoteSystems[__${stat.index}__].name}"></span></td>
								<td><input th:id="${'description-'+stat.index}" type="text"
									class="form-control" placeholder="Beschreibung"
									th:field="*{remoteSystems[__${stat.index}__].description}"
									th:errorclass="field-tip" /><span class="tip-content"
									th:errors="*{remoteSystems[__${stat.index}__].description}"></span></td>
								<td><input th:id="${'switch-'+stat.index}" type="checkbox"
									name="remoteSystem-state-switch" data-size="mini"
									th:checked="*{remoteSystems[__${stat.index}__].enabled}"
									data-on-color="success" data-off-color="warning"></input> <input
									type="hidden" th:id="${'hiddenSwitch-'+stat.index}"
									th:field="*{remoteSystems[__${stat.index}__].enabled}" /></td>
								<td><a class="a_delete" th:id="${'a_delete-'+stat.index}"
									href="#" th:title="#{remoteSystemsActionDelete}"><span
										class="glyphicon glyphicon-remove"> </span></a> <a class="a_edit"
									th:id="${'a_edit-'+stat.index}" href="#"
									th:title="#{remoteSystemsActionEdit}"><span
										class="glyphicon glyphicon-edit"> </span></a><input type="hidden"
									th:id="${'hiddenRid-'+stat.index}"
									th:field="*{remoteSystems[__${stat.index}__].id}" /><input
									type="hidden" th:id="${'hiddenDelete-'+stat.index}"
									th:field="*{remoteSystems[__${stat.index}__].delete}" /></td>
							</tr>
						</tbody>
					</table>
					<div id="remoteSystemEditPanel" class="panel panel-info">
						<div class="panel-heading">
							<span th:text="#{remoteSystemEditPanelHeader}"></span><span
								id="remoteSystemEditPanelHeadingName"></span>
						</div>
						<div class="panel-body">
							<div class="container-fluid">
								<div class="row margin-content">

									<div class="col-md-12">
										<ul class="list-group">
											<li class="list-group-item"><div>
													<label class="control-label"><span
														th:text="#{remoteSystemLoginUrlLabel}"></span></label>
													<div>
														<input type="text" class="form-control" id="loginUrl"
															th:placeholder="#{remoteSystemLoginUrlLabel}" />
													</div>
												</div></li>
											<li class="list-group-item"><div>
													<label class="control-label"><span
														th:text="#{remoteSystemLoginParameterLabel}"></span></label>
													<div>
														<input type="text" class="form-control" id="remoteSystemLoginParameter"
															th:placeholder="#{remoteSystemLoginParameterLabel}" />
													</div>
												</div></li>
											<li class="list-group-item"><div>
													<label class="control-label"><span
														th:text="#{remoteSystemPasswordParameterLabel}"></span></label>
													<div>
														<input type="text" class="form-control" id="remoteSystemPasswordParameter"
															th:placeholder="#{remoteSystemPasswordParameterLabel}" />
													</div>
												</div></li>
											<li class="list-group-item"><div>
													<label class="control-label"><span
														th:text="#{remoteSystemLogoutUrlLabel}"></span></label>
													<div>
														<input type="text" class="form-control" id="remoteSystemLogoutUrl"
															th:placeholder="#{remoteSystemLogoutUrlLabel}" />
													</div>
												</div></li>
										</ul>
									</div>
								</div>
								<button id="buttonRemoteSystemEditDone" class="btn btn-primary btn-done"
									type="button">
									<span th:text="#{buttonDone}"></span>
								</button>
							</div>
						</div>
					</div>
					<input id="hiddenRemoteSystemIndex" type="hidden" value="" />
				</form>
			</div>
		</div>
	</div>
</body>
</html>